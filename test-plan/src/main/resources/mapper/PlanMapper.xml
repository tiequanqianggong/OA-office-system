<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.plan.mapper.PlanMapper">
    <resultMap type="Plan" id="PlanResult">
        <result property="testPlanId"    column="test_plan_id"    />
        <result property="testPlanName"    column="test_plan_name"    />
        <result property="priority"    column="priority"    />
        <result property="state"    column="state"    />
        <result property="isAttention"    column="is_attention"    />
        <result property="passRate"    column="pass_rate"    />
        <result property="itemId"    column="item_id"    />
        <result property="endTime"    column="end_time"    />
        <result property="createTime"    column="create_time"    />
        <result property="createBy"    column="create_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="updateBy"    column="update_by"    />
    </resultMap>

    <delete id="deleteByPlanId" parameterType="Long">
        update test_plan set del_flag = 1 where test_plan_id = #{planId}
    </delete>
    <delete id="deleteByPlanIds" parameterType="Long">
        update test_plan set del_flag = 1  where test_plan_id in
        <foreach collection="array" item="planId" open="(" separator="," close=")">
            #{planId}
        </foreach>
    </delete>

    <select id="selectPlanList" resultMap="PlanResult">
        select test_plan_id, test_plan_name, priority, state, is_attention, pass_rate, item_id, end_time, create_time, create_by, update_time, update_by
        from test_plan where del_flag = '0'
    </select>
    
    <select id="selectItemName" parameterType="long" resultType="String">
        SELECT i.project_name
        FROM test_plan tp
        INNER JOIN project i ON tp.item_id = i.id
        WHERE tp.test_plan_id = #{id};
    </select>


</mapper>