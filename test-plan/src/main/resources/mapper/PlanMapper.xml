<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.plan.mapper.PlanMapper">
    <resultMap type="Plan" id="PlanResult">
        <result property="testPlanId" column="test_plan_id"/>
        <result property="type" column="plan_type"/>
        <result property="content" column="content"/>
        <result property="state" column="state"/>
        <result property="output" column="output"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="createTime" column="create_time"/>
        <result property="createBy" column="create_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="updateBy" column="update_by"/>
    </resultMap>

    <sql id="selectPlanVo">
        select test_plan_id,
               plan_type,
               content,
               state,
               output,
               start_time,
               end_time
        from test_plan
    </sql>
    <select id="selectPlanList" resultMap="PlanResult">
        <include refid="selectPlanVo"/> where del_flag = 0
    </select>

    <select id="selectPlanByTestPlanId" parameterType="Long" resultMap="PlanResult">
        <include refid="selectPlanVo"/>
        where test_plan_id = #{testPlanId} AND del_flag = 0
    </select>
    
    <select id="selectPlanRecently" resultMap="PlanResult">
        SELECT test_plan_id, content, start_time, end_time
        FROM test_plan
        ORDER BY end_time DESC
        LIMIT 5;
    </select>

    <delete id="deletePlanByTestPlanId" parameterType="Long">
        update test_plan set del_flag = 1
        where test_plan_id = #{testPlanId}
    </delete>

    <delete id="deletePlanByTestPlanIds" parameterType="String">
        update test_plan set del_flag = 1 where test_plan_id in
        <foreach item="testPlanId" collection="array" open="(" separator="," close=")">
            #{testPlanId}
        </foreach>
    </delete>

    <insert id="insertPlan" parameterType="Plan" useGeneratedKeys="true" keyProperty="testPlanId">
        insert into test_plan
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="testPlanId != null">test_plan_id,</if>
            <if test="type != null or content != null or state != null or output != null or startTime != null or endTime != null">
                <if test="type != null">plan_type,</if>
                <if test="content != null">content,</if>
                <if test="state != null">state,</if>
                <if test="output != null">output,</if>
                <if test="startTime != null">start_time,</if>
                <if test="endTime != null">end_time,</if>
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="testPlanId != null">#{testPlanId},</if>
            <if test="type != null or content != null or state != null or output != null or startTime != null or endTime != null">
                <if test="type != null">#{type},</if>
                <if test="content != null">#{content},</if>
                <if test="state != null">#{state},</if>
                <if test="output != null">#{output},</if>
                <if test="startTime != null">#{startTime},</if>
                <if test="endTime != null">#{endTime},</if>
            </if>
        </trim>
    </insert>


    <update id="updatePlan" parameterType="Plan">
        update test_plan
        <trim prefix="SET" suffixOverrides=",">
            <if test="type != null">plan_type = #{type},</if>
            <if test="content != null">content = #{content},</if>
            <if test="state != null">state = #{state},</if>
            <if test="output != null">output = #{output},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>

        </trim>
        where test_plan_id = #{testPlanId}
    </update>

    <update id="updateTestPlan" parameterType="Plan">
        UPDATE test_plan
        <set>
            <if test="type != null">plan_type = #{type},</if>
            <if test="content != null">content = #{content},</if>
            <if test="state != null">state = #{state},</if>
            <if test="output != null">output = #{output},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
        </set>
        WHERE test_plan_id = #{testPlanId}
    </update>

    <delete id="deleteComplete">
        delete from test_plan where del_flag = 1
    </delete>

    <select id="searchTestPlans" parameterType="Plan" resultMap="PlanResult">
        SELECT * FROM test_plan
        WHERE  del_flag = 0
           AND (test_plan_id  LIKE CONCAT('%', #{testPlanId}, '%')
           OR plan_type LIKE CONCAT('%', #{type}, '%')
           OR content LIKE CONCAT('%', #{content}, '%')
           OR state LIKE CONCAT('%', #{state}, '%')
           OR output LIKE CONCAT('%', #{output}, '%')
           OR start_time LIKE CONCAT('%', #{startTime}, '%')
           OR end_time LIKE CONCAT('%', #{endTime}, '%'))
    </select>
</mapper>